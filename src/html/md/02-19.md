# ✅ `<script>` 실행 방식: `async` vs `defer` vs `module`

`async`와 `defer`는 **외부 스크립트 (`src=""`)를 불러올 때만 동작**하며,  
`module`은 **ES6 `import/export`를 사용할 때 반드시 필요**합니다.

---

## 📌 `async` vs `defer` 비교

| 속성    | HTML 파싱 중 실행?     | 실행 순서 보장?           | 실행 타이밍              |
| ------- | ---------------------- | ------------------------- | ------------------------ |
| `async` | ✅ (즉시 실행)         | ❌ (랜덤 실행)            | 다운로드 완료 즉시 실행  |
| `defer` | ❌ (HTML 파싱 후 실행) | ✅ (작성된 순서대로 실행) | HTML이 다 로드된 후 실행 |

### ✅ `async` (비동기 실행)

```html
<script src="script.js" async></script>
```

- **HTML 파싱과 동시에 스크립트를 다운로드**
- **다운로드가 끝나는 즉시 실행**
- **여러 개의 `async` 스크립트가 있으면 실행 순서가 보장되지 않음**
- **독립적인 기능 (예: 광고, 분석 스크립트)에 적합**

**📌 `async` 예제**

```html
<script src="analytics.js" async></script>
<script src="ads.js" async></script>
```

✅ `analytics.js`와 `ads.js`가 **서버 응답 속도에 따라 랜덤한 순서로 실행될 수 있음.**

---

### ✅ `defer` (순서 보장)

```html
<script src="script.js" defer></script>
```

- **HTML 파싱이 끝난 후 실행됨**
- **여러 개의 `defer` 스크립트는 HTML에 적힌 순서대로 실행됨**
- **`DOMContentLoaded` 이벤트 직전에 실행됨**
- **페이지 전체에 영향을 주는 스크립트 (예: DOM 조작, UI 관련 JS)에 적합**

**📌 `defer` 예제**

```html
<script src="library.js" defer></script>
<script src="app.js" defer></script>
```

✅ `library.js`가 먼저 실행된 후 `app.js`가 실행됨.

---

## 📌 `module`이란?

```html
<script type="module">
  import { init } from './script.js';
  init();
</script>
```

- **자동으로 `defer`와 같은 동작 (HTML 다 읽고 실행)**
- **ES6 모듈 시스템 (`import/export`)을 사용 가능**
- **각 파일이 독립적인 범위를 가짐 (전역 변수 충돌 방지)**

### ✅ `module`을 꼭 써야 하는 경우

1. **ES6 `import/export` 사용 시**

   ```js
   // utils.js
   export function greet(name) {
     console.log(`Hello, ${name}!`);
   }

   // main.js
   import { greet } from './utils.js';
   greet('Sakura');
   ```

2. **전역 변수 오염을 방지하고 싶을 때**
3. **`defer`보다 더 강력한 기능이 필요할 때 (모듈 시스템 활용 가능)**

---

## 🚀 `async` vs `defer` vs `module` 정리

| 속성     | HTML 파싱과 병행?  | 실행 순서 보장? | 실행 타이밍                        | 사용 예제            |
| -------- | ------------------ | --------------- | ---------------------------------- | -------------------- |
| `async`  | ✅ (병렬 다운로드) | ❌ (랜덤 실행)  | 다운로드 완료 즉시 실행            | 분석, 광고           |
| `defer`  | ✅ (병렬 다운로드) | ✅ (순서 유지)  | HTML 파싱 후 실행                  | 일반적인 JS          |
| `module` | ✅ (병렬 다운로드) | ✅ (순서 유지)  | HTML 파싱 후 실행 + 모듈 기능 지원 | `import/export` 사용 |

---

## 📌 결론

✔ **페이지에 영향을 주는 주요 스크립트 → `defer` 사용**  
✔ **독립적인 스크립트 (예: 광고, 분석) → `async` 사용**  
✔ **모듈 시스템을 사용할 경우 → `type="module"` 사용 (`import/export` 가능, 자동 `defer`)**
